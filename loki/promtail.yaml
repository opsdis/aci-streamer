server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions.yaml

clients:
  - url: http://localhost:3100/loki/api/v1/push

scrape_configs:

  - job_name: aci-streamer
    static_configs:
      - targets:
          - localhost
        labels:
          job: aci-streamer
          __path__: /tmp/aci.log

    pipeline_stages:
      - json:
          expressions:
            subscribtion: subscribtion
      - labels:
          subscribtion:
      - match:
          selector: '{subscribtion="sessions"}'
          stages:
            - json:
                expressions:
                  message: message
                  status: status
            - labels:
                status:
      - match:
          selector: '{subscribtion="faults"}'
          stages:
            - json:
                expressions:
                  severity: severity
                  type: type
                  ack: ack
                  domain: domain
                  descr: descr
                  dn: dn
                  message: message
                  podid: podid
                  nodeid: nodeid
                  timestamp: timestamp
                  fabric: fabric
                  cause: cause
            - timestamp:
                source: lastTransition
                format: 2020-07-30T23:53:40.016+00:00
            - labels:
                severity:
                type:
                ack:
                domain:
                podid:
                nodeid:
                fabric:
                cause:
                #subscribtion:
            - match:
                selector: '{severity="cleared"} |~ ".*"'
                action: drop
      - output:
          source: message

